%==================================================================================================
\section{\textit{Variational Multi-Scale}} \label{VMS}
%==================================================================================================

O Método Variacional Multiescala, introduzido por \citeonline{hughes1995multiscale,hughes1998variational,hughes2000large}, é um modelo de estabilização baseado na separação dos espaços tentativa e teste em subespaços que representam as escalas grosseiras, que se tratam de subespaços de dimensão finita, denotadas por uma barra sobrescrita, e subespaços que representam as escalas refinadas, que são subespaços de dimensão infinita e denotadas por $'$, ou seja:

\begin{subequations}
    \begin{align}
         & \script{S}_u=\bar{\script{S}}_u\oplus\script{S}'_u\text{,}  \\
         & \script{S}_p=\bar{\script{S}}_p\oplus\script{S}'_p\text{,}  \\
         & \script{V}_u=\bar{\script{V}}_u\oplus\script{V}'_u\text{ e} \\
         & \script{V}_p=\bar{\script{V}}_p\oplus\script{V}'_p\text{.}
    \end{align}
\end{subequations}

Assim, o sistema a ser resolvido parte do apresentado na Eq. \eqref{eq:NS-Euler}, que em sua forma fraca se encontra em \eqref{eq:WeakForm2}. Primeiramente realiza-se a separação dos membros em:

\begin{subequations}
    \begin{align}
         & u_i=\bar{u}_i+u'_i\text{,}  \\
         & p=\bar{p}+p'\text{,}        \\
         & w_i=\bar{w}_i+w'_i\text{ e} \\
         & q=\bar{q}+q'\text{.}
    \end{align}
\end{subequations}

Seguindo \citeonline{bazilevs2007variational} adota-se $w_i=\bar{w}_i$, $q=\bar{q}$ e assume-se que a parcela em escala fina $u'_i$ e $p'$ são modeladas como:

\begin{subequations}
    \begin{equation}
        \BB{u}'=-\frac{\tau_{\sups}}{\rho}\rM\text{ e}
    \end{equation}
    \begin{equation}
        p'=-\rho\nu_{\lsic}\rC\text{,}
    \end{equation}
    \label{eq:VMS-fine}
\end{subequations}

\noindent onde $\tau_{\sups}$ e $\nu_{\lsic}$ são termos estabilizadores, propostos por \citeonline{bazilevs2013computational} como:
%página 80 do pdf de hughes2013 e 65 de fernandes2020

\begin{subequations}
    \begin{equation}
        \tau_{\sups}=\bigpar{\frac{4}{\Delta t^2}+(\BBB{u}-\HBB{u})\cdot\BB{G}(\BBB{u}-\HBB{u})+C_I\nu^2\BB{G}:\BB{G}}^{-1/2}\text{ e}
    \end{equation}
    \begin{equation}
        \nu_{\lsic}=(\tr{\BB{G}}\tau_{\sups})^{-1}\text{,}
    \end{equation}
    \label{eq:TermEstab}
\end{subequations}

\noindent onde $C_I$ é uma constante e:

\begin{equation}
    \BB{G}=\frac{\partial\BB{\xi}}{\partial\BB{y}}^T\frac{\partial\BB{\xi}}{\partial\BB{y}}\text{.}
\end{equation}

Já os termos $\rM$ e $\rC$ são os resíduos da equação de conservação da quantidade de movimento e da equação da continuidade, respectivamente, ou seja,

\begin{subequations}
    \begin{equation}
        \rMi{i}=\rho\bigpar{\dot{\bar{u}}_i+(\bar{u}_j-\hat{u}_j)\bar{u}_{i,j}-\bar{f}_i}-\sigma_{ji,j}\text{ e}
    \end{equation}
    \begin{equation}
        \rCi=\bar{u}_{i,i}\text{.}
    \end{equation}
\end{subequations}

Outra forma de se determinar $ \tau_{\sups}$ e $\nu_{\lsic}$, também apresentada em \citeonline{bazilevs2013computational}, consiste em fazer:

\begin{subequations}
    \begin{equation}
        \tau_{\sups}=\bigpar{\frac{1}{\tau_{\sugn 1}^2}+\frac{1}{\tau_{\sugn 2}^2}+\frac{1}{\tau_{\sugn 3}^2}}^{-1/2}\text{ e}
    \end{equation}
    \begin{equation}
        \nu_{\lsic}=\tau_{\sups}\norm{\BBB{u}-\HBB{u}}^2\text{,}
    \end{equation}
\end{subequations}

\noindent sendo:

\begin{subequations}
    \begin{align}
         & \tau_{\sugn 1}=\bigpar{\sum_{a=1}^{n_{en}}{\abs{(\BBB{u}-\HBB{u})\cdot\Ny N_a}}}^{-1}\text{,} \\
         & \tau_{\sugn 2}=\frac{\Delta t}{2}\text{,}                                                     \\
         & \tau_{\sugn 3}=\frac{h_{\rgn}^2}{4\nu}\text{,}                                                \\
         & h_\rgn=2\bigpar{\sum_{a=1}^{n_{en}}{\abs{\BB{r}\cdot\Ny N_a}}}^{-1}\text{ e}                  \\
         & \BB{r}=\frac{\Ny\norm{\BBB{u}-\HBB{u}}}{\norm{\Ny\norm{\BBB{u}-\HBB{u}}}}\text{.}
    \end{align}
\end{subequations}

Assim, obtém-se o problema do Método Variacional Multiescala Baseado em Resíduos (\textit{Residual-Based Variational Multi-Scale} - RBVMS) que consiste em: determinar $\BBB{u}\in\bar{\script{S}}_u$ e $\bar{p}\in\bar{\script{S}}_p$, tais que para todo $\BBB{w}\in\bar{\script{V}}_u$ e $\bar{q}\in\bar{\script{V}}_p$:

\begin{equation}
    \begin{split}
        &\intDom{\bar{w}_i\rho\bigpar{\dot{\bar{u}}_i+(\bar{u}_j-\hat{u}_j)\bar{u}_{i,j}-\bar{f}_i}}+\intDom{\bar{w}_{i,j}\bar{\sigma}_{ij}}-\intNeumann{\bar{w}_i\bar{h}_i}+\intDom{\bar{q}\bar{u}_{i,i}}-\\
        &\SintDom{\rho\bigpar{(\bar{u}_j-\hat{u}_j)\bar{w}_{i,j}+\frac{\bar{q}_{,i}}{\rho}}u'_i}-\SintDom{\bar{w}_{i,i}p'}+\\
        &\SintDom{\rho\bar{w}_iu'_j\bar{u}_{i,j}}-\SintDom{\rho\bar{w}_{i,j}u'_iu'_j}=0
        \text{,}
        \label{eq:RBVMS1}
    \end{split}
\end{equation}

\noindent o que pode ser reescrito ainda, substituindo-se $u'_j$ e $p'$ por \eqref{eq:VMS-fine}:

\begin{equation}
    \begin{split}
        &\intDom{\bar{w}_i\rho\bigpar{\dot{\bar{u}}_i+(\bar{u}_j-\hat{u}_j)\bar{u}_{i,j}-\bar{f}_i}}+\intDom{\bar{w}_{i,j}\bar{\sigma}_{ij}}-\intNeumann{\bar{w}_i\bar{h}_i}+\intDom{\bar{q}\bar{u}_{i,i}}+\\
        &\SintDom{\tau_\sups\bigpar{(\bar{u}_j-\hat{u}_j)\bar{w}_{i,j}+\frac{\bar{q}_{,i}}{\rho}}\rMi{i}}+\SintDom{\rho\nu_\lsic\bar{w}_{i,i}\rCi}-\\
        &\SintDom{\tau_\sups\bar{w}_i\rMi{j}\bar{u}_{i,j}}-\SintDom{\frac{\bar{w}_{i,j}}{\rho}(\tau_\sups\rMi{i})(\tau_\sups\rMi{j})}=0
        \text{.}
        \label{eq:RBVMS1}
    \end{split}
\end{equation}

Para a discretização do problema em descrição Euleriana pode-se realizar a separação da dependência espacial e temporal para as funções tentativas e testes como:

\begin{subequations}
    \begin{align}
         & \bar{u}_i(\BB{y},t)=\sum_{\BB{\eta}^s}{U_i^a(t)N_a^u(\BB{y})}\text{,}\label{eq:uh} \\
         & \bar{p}(\BB{y},t)=\sum_{\BB{\eta}^s}{P^a(t)N_a^p(\BB{y})}\text{,}                  \\
         & \bar{w}_i(\BB{y})=\sum_{\BB{\eta}^w}{W_i^aN_a^u(\BB{y})}\text{ e}\label{eq:w-sep}  \\
         & \bar{q}(\BB{y})=\sum_{\BB{\eta}^w}{Q^aN_a^p(\BB{y})}\text{,}\label{eq:q-sep}
    \end{align}
\end{subequations}

\noindent onde $N_a^u$ e $N_a^p$ são as funções de forma para aproximação do campo de velocidades e de pressões, respectivamente, associadas ao nó $a$ da malha e $\BB{\eta}^s$ o respectivo índice desse nó, assim como $\BB{\eta}^w$ são os índices referentes aos nós da malha para as funções teste.

Já para a descrição ALE as funções de forma $N_a(\BB{y},t)$ são definidas com base na configuração de referência da malha como:

\begin{equation}
    N_a(\BB{y},t)=\hat{N}_a(\HBB{f}^{-1}(\BB{y},t))\text{,}
\end{equation}

\noindent onde $\HBB{f}(\BB{y},t)$ é a função de mudança de configuração da configuração de referência da malha para a configuração atual $\hat{\Omega}\to\Omega$, conforme apresentado no item \ref{CFD-ALE}, dada em sua forma discreta por:

\begin{equation}
    \HBB{f}(\HBB{x},t)=\sum_{a\in\BB{\eta}^s}{(\HBB{x}_a+\Delta\HBB{x}_a(t))\hat{N}_a(\HBB{x})}\text{,}
\end{equation}

\noindent sendo $\HBB{x}_a$ as posições nodais em $\hat{\Omega}$, $\Delta\HBB{x}(t)$ o deslocamento nodal e $\hat{N}_a$ é a função de forma fixa da discretização de $\hat{\Omega}$. Nota-se, portanto, que as funções $N_a(\BB{y},t)$ possuem dependência temporal devido à movimentação da malha.

Substituindo-se \eqref{eq:w-sep} e \eqref{eq:q-sep} em \eqref{eq:RBVMS1}, e levando-se em conta a arbitrariedade de $W^a$ e $Q^a$, a forma fraca espacialmente discreta fica:

\begin{subequations}
    \begin{equation}
        \begin{split}
            \NMi{i}{a}=&
            \intDom{N_a^u\rho\bigpar{\dot{\bar{u}}_i+(\bar{u}_j-\hat{u}_j)\bar{u}_{i,j}-\bar{f}_i}}+\intDom{N_{a,j}^u\bar{\sigma}_{ij}}-\intNeumann{N_a^u\bar{h}_i}-\\
            &\SintDom{\rho N_{a,j}^u(\bar{u}_j-\hat{u}_j)u'_i}-\SintDom{N_{a,i}^up'}+\\
            &\SintDom{\rho N_a^u\bar{u}_{i,j}u'_j}-\SintDom{\rho N_{a,j}^uu'_iu'_j}
            =0\text{,}
        \end{split}
    \end{equation}
    \begin{equation}
        \NCi{a}=\intDom{N_a^p\bar{u}_{i,i}}-\SintDom{N_{a,i}^pu'_i}=0
    \end{equation}
    \label{Eq:Residuos-Euler}
\end{subequations}

Sendo os vetores $\BB{U}=[\BB{u}_B]$, $\dot{\BB{U}}=[\dot{\BB{u}}_B]$ e $\BB{P}=[p_B]$, que representam, respectivamente, os parâmetros nodais de velocidade, a primeira derivada temporal dos parâmetros nodais de velocidade, e os parâmetros nodais de pressão, então o problema a ser resolvido consiste em: encontrar $\BB{U}$, $\dot{\BB{U}}$ e $\BB{P}$, tais que:

\begin{subequations}
    \begin{align}
         & \NM(\BB{U},\dot{\BB{U}},\BB{P})=\BB{0}\text{ e} \\
         & \NC(\BB{U},\dot{\BB{U}},\BB{P})=\BB{0}\text{.}
    \end{align}
\end{subequations}

Omitindo-se os dois últimos termos da equação \eqref{eq:RBVMS1} e adotando-se valores diferentes de $\tau$ para as equações de conservação da quantidade de movimento e da continuidade, chega-se à formulação estabilizada SUPG/PSPG \cite{tezduyar2000finite,tezduyar2003computation,catabriga2005compressible,catabriga2006compressible}, dada por:

\begin{equation}
    \begin{split}
        &\intDom{\bar{w}_i\rho\bigpar{\dot{\bar{u}}_i+(\bar{u}_j-\hat{u}_j)\bar{u}_{i,j}-\bar{f}_i}}+\intDom{\bar{w}_{i,j}\bar{\sigma}_{ij}}-\intNeumann{\bar{w}_i\bar{h}_i}+\intDom{\bar{q}\bar{u}_{i,i}}-\\
        &\SintDom{\tau_\supg\bar{w}_{i,j}(\bar{u}_j-\hat{u}_j)\rMi{i}}-\SintDom{\tau_\pspg\frac{q_{,i}}{\rho}\rMi{i}}-\\
        &\SintDom{\rho\nu_\lsic\bar{w}_{i,i}\rCi}=0
        \text{,}
        \label{eq:SUPG-PSPG}
    \end{split}
\end{equation}

\noindent onde, segundo \citeonline{bazilevs2013computational}, adota-se $\tau_\pspg=\tau_\supg=\tau_\sups$ com sucesso para uma boa variedade de problemas.

%==================================================================================================
\subsection{Integração temporal} \label{IT-VMS}
%==================================================================================================

Até o momento, apresentou-se uma forma semi-discreta das equações governantes (discreta no espaço, porém contínua no tempo) (Equações \eqref{Eq:Residuos-Euler}). Dessa forma torna-se necessária a devida discretização temporal das variáveis, que pode ocorrer de diferentes formas. Tal como apontado por \citeonline{reddy2010finite}, tem-se, por exemplo, integradores explícitos, como o integrador baseado em diferenças adiantadas, implícitos, como o baseado em diferenças finitas atrasadas, e os denominados semi-explícitos. Segundo o autor os integradores implícitos possuem vantagens sobre os explícitos, uma vez que se observa a implicidade natural da pressão em escoamentos incompressíveis e é possível obtenção de estabilidade incondicional do integrador temporal.

O integrador temporal utilizado no presente trabalho é o denominado integrador $\alpha$-generalizado, desenvolvido por \citeonline{chung1993time}, que possui a capacidade de representar adequadamente problema de escoamentos incompressíveis, além de permitir a introdução de difusão numérica ao processo de forma controlada \cite{fernandes2020tecnica}.

Esse integrador parte da consideração de valores intermediários de aceleração e velocidade em um intervalo $[t_n,t_{n+1}]$ no $n$-ésimo passo de tempo, representados respectivamente por $\dot{U}_i^{n+\alpha_m}$ e $U_i^{n+\alpha_f}$:

\begin{subequations}
    \begin{equation}
        \dot{U}_i^{n+\alpha_m}=\dot{U}_i^n+\alpha_m(\dot{U}_i^{n+1}-\dot{U}_i^n)\text{ e}
    \end{equation}
    \begin{equation}
        U_i^{n+\alpha_f}=U_i^n+\alpha_f(U_i^{n+1}-U_i^n)\text{.}
    \end{equation}
\end{subequations}

Já para se relacionar a velocidade à aceleração, emprega-se a aproximação de Newmark \cite{bazilevs2013computational}:

\begin{equation}
    U_i^{n+1}=U_i^n+\Delta t_n\bigpar{(1-\gamma)\dot{U}_i^n+\gamma\dot{U}_i^{n+1}}\text{,}
\end{equation}

\noindent sendo $\alpha_m$, $\alpha_f$ e $\gamma$ valores escolhidos arbitrariamente, observando-se as necessidades de estabilidade e precisão do método.

De acordo com \citeonline{chung1993time,jansen2000generalized,bazilevs2013computational}, a precisão de segunda ordem dessa aproximação pode ser atingida uma vez que:

\begin{equation}
    \gamma=\frac{1}{2}+\alpha_m-\alpha_f\text{,}
\end{equation}

\noindent enquanto a estabilidade incondicional é obtida caso:

\begin{equation}
    \alpha_m\geq\alpha_f\geq\frac{1}{2}\text{.}
\end{equation}

Ainda é possível escrever, a partir da Equação \eqref{eq:one-par-stable}, $\alpha_m$ e $\alpha_f$ em termos de um parâmetro arbitrário único  ($0\leq\rho_\infty\leq1$), que representa o raio espectral da matriz amplificação para $\Delta t\to\infty$, o qual é utilizado para controlar as dissipações de alta-frequência.

\begin{subequations}
    \begin{equation}
        \alpha_m=\frac{1}{2}\bigpar{\frac{3-\rho_\infty}{1+\rho_\infty}}\text{ e}
    \end{equation}
    \begin{equation}
        \alpha_f=\frac{1}{1+\rho_\infty}\text{.}
    \end{equation}
    \label{eq:one-par-stable}
\end{subequations}

Para o caso de $\rho_\infty=1$ não ocorre a introdução de difusão numérica, enquanto para $\rho_\infty=0$ se tem a máxima dissipação de altas frequências \cite{fernandes2020tecnica}.

Sendo assim, os resíduos obtidos anteriormente podem ser escritos em termos dos valores intermediários como:

\begin{subequations}
    \begin{equation}
        \NM(\dot{\BB{U}}^{n+\alpha_m},\BB{U}^{n+\alpha_f},\BB{P}^{n+1})=\BB{0}
    \end{equation}
    \begin{equation}
        \NC(\dot{\BB{U}}^{n+\alpha_m},\BB{U}^{n+\alpha_f},\BB{P}^{n+1})=\BB{0}
    \end{equation}
\end{subequations}

%%==================================================================================================
%\subsection{Procedimento iterativo} \label{Comp-VMS}
%%==================================================================================================
%
%O procedimento para minimizar os vetores resíduo obtido parte do método de Newton-Raphson, no qual os valores a serem corrigidos são os vetores de acelerações nodais ($\dot{\BB{U}}$) e de pressões nodais ($\BB{P}$). Dessa forma, o problema a ser resolvido para a correção dessas variáveis é:
%
%\begin{equation}
%    \begin{bmatrix}
%        \der{(N_M)_i^a}{(\dot{U}_j^b)^{n+1}} & \der{(N_M)_i^a}{(P^b)^{n+1}} \\
%        \der{(N_C)^a}{(\dot{U}_j^b)^{n+1}}   & \der{(N_C)^a}{(P^b)^{n+1}}
%    \end{bmatrix}
%    \begin{bmatrix}
%        \Delta(\dot{U}_j^b)^{n+1} \\
%        \Delta (P^b)^{n+1}
%    \end{bmatrix}=-
%    \begin{bmatrix}
%        (N_M)_i^a \\
%        (N_C)^a
%    \end{bmatrix}\text{,}
%    \label{Eq:Newton-Raphson}
%\end{equation}
%
%\noindent em que, para uma descrição ALE:
%
%\begin{subequations}
%    \begin{equation}
%        \begin{split}
%            \der{(N_M)_i^a}{(\dot{U}_j^b)^{n+1}}=&\am\intDomna{\rho N_aN_b}\dij+\am\intDomna{\rho\tsups N_{a,k}N_{b}\uub{k}}\dij+\\
%            &\agdt\intDomna{\rho N_aN_{b,k}\uub{k}}\dij+\agdt\intDomna{\mu N_{a,k}N_{b,k}}\dij+\\
%            &\agdt\intDomna{\mu N_{a,j}N_{b,i}}+\agdt\intDomna{\rho\nlsic N_{a,i}N_{b,j}}+\\
%            &\agdt\intDomna{\rho\tsups N_{a,k}N_{b,m}\uub{k}\uub{m}}\dij+\\
%            &\agdt\intDomna{\rho N_aN_b\bar{u}_{i,j}}+\agdt\intDomna{\rho\tsups N_{a,k}N_b\uub{k}\bar{u}_{i,j}}-\\
%            &\am\intDomna{\rho\tsups N_aN_b\bar{u}_{i,j}}-\\
%            &\agdt\intDomna{\rho\tsups N_aN_{b,m}\uub{m}\bar{u}_{i,j}}-\\
%            &\agdt\intDomna{\rho\tsups N_aN_b\bar{u}_{i,k}\bar{u}_{k,j}}\text{,}
%        \end{split}
%    \end{equation}
%    \begin{equation}
%        \begin{split}
%            \der{(N_M)_i^a}{(P^b)^{n+1}}=&-\intDomna{N_{a,i}N_b}+\intDomna{\tsups N_{a,j}N_{b,i}\uub{j}}-\\
%            &\intDomna{\tsups N_aN_{b,j}\bar{u}_{i,j}}\text{,}
%        \end{split}
%    \end{equation}
%    \begin{equation}
%        \begin{split}
%            \der{(N_C)^a}{(\dot{U}_j^b)^{n+1}}=&\agdt\intDomna{N_aN_{b,j}}+\am\intDomna{\tsups N_{a,j}N_b}+\\
%            &\agdt\intDomna{\tsups N_{a,j}N_{b,m}\uub{m}}+\\
%            &\agdt\intDomna{\tsups N_{a,i}N_b\bar{u}_{i,j}}\text{ e}
%        \end{split}
%    \end{equation}
%    \begin{equation}
%        \der{(N_C)^a}{(P^b)^{n+1}}=\intDomna{\frac{\tsups}{\rho}N_{a,i}N_{b,i}}\text{,}
%    \end{equation}
%\end{subequations}
%
%\noindent em que $\agdt=\alpha_f\gamma\Delta t$ e:
%
%\begin{equation}
%    \Omega^{n+\alpha_f}=\left\{\bar{\BB{x}}|\bar{\BB{x}}(\hat{\BB{x}},t^{n+\alpha_f})=\alpha_f\bar{\BB{x}}(\hat{\BB{x}},t^{n+1})+(1-\alpha_f)\bar{\BB{x}}(\hat{\BB{x}},t^n)\right\}\text{.}
%\end{equation}
%
%Para uma descrição Euleriana, considera-se a velocidade da malha como nula na formulação apresentada.
%
%Sendo assim, o pseudocódigo apresentado no algoritmo presente no Apêndice \ref{Ap:MEF-VMS} mostra o procedimento para obtenção da solução aproximada.